/*     */ package xyz.pixelatedw.mineminenomi.abilities;
/*     */ 
/*     */ import java.io.Serializable;
/*     */ import java.lang.invoke.SerializedLambda;
/*     */ import java.util.function.Supplier;
/*     */ import javax.annotation.Nullable;
/*     */ import net.minecraft.entity.Entity;
/*     */ import net.minecraft.entity.LivingEntity;
/*     */ import net.minecraft.entity.projectile.ProjectileEntity;
/*     */ import net.minecraft.util.DamageSource;
/*     */ import net.minecraft.util.text.ITextComponent;
/*     */ import net.minecraft.util.text.TranslationTextComponent;
/*     */ import org.apache.commons.lang3.tuple.ImmutablePair;
/*     */ import org.apache.commons.lang3.tuple.Pair;
/*     */ import xyz.pixelatedw.mineminenomi.abilities.haki.BusoshokuHakiEmissionAbility;
/*     */ import xyz.pixelatedw.mineminenomi.api.abilities.AbilityCore;
/*     */ import xyz.pixelatedw.mineminenomi.api.damagesource.AbilityDamageSource;
/*     */ import xyz.pixelatedw.mineminenomi.api.damagesource.SourceElement;
/*     */ import xyz.pixelatedw.mineminenomi.api.damagesource.SourceHakiNature;
/*     */ import xyz.pixelatedw.mineminenomi.api.helpers.AbilityHelper;
/*     */ import xyz.pixelatedw.mineminenomi.api.helpers.HakiHelper;
/*     */ import xyz.pixelatedw.mineminenomi.config.AbilitiesConfig;
/*     */ import xyz.pixelatedw.mineminenomi.config.CommonConfig;
/*     */ import xyz.pixelatedw.mineminenomi.data.entity.ability.AbilityDataCapability;
/*     */ import xyz.pixelatedw.mineminenomi.data.entity.devilfruit.DevilFruitCapability;
/*     */ import xyz.pixelatedw.mineminenomi.data.entity.entitystats.EntityStatsCapability;
/*     */ import xyz.pixelatedw.mineminenomi.entities.projectiles.AbilityProjectileEntity;
/*     */ import xyz.pixelatedw.mineminenomi.events.FactionEvents;
/*     */ import xyz.pixelatedw.mineminenomi.init.ModDamageSource;
/*     */ import xyz.pixelatedw.mineminenomi.particles.effects.ParticleEffect;
/*     */ import xyz.pixelatedw.mineminenomi.wypi.WyHelper;
/*     */ import xyz.pixelatedw.mineminenomi.wypi.WyRegistry;
/*     */ 
/*     */ 
/*     */ 
/*     */ public class LogiaInvulnerabilityAbility
/*     */   extends SourceImmunityAbility
/*     */ {
/*  39 */   public static final ITextComponent[] DESCRIPTION = (ITextComponent[])AbilityHelper.registerDescriptionText("mineminenomi", "logia_invulnerability", new Pair[] {
/*  40 */         (Pair)ImmutablePair.of("Allows the user to avoid attacks by instinctively transforming parts of their body into their specific element", null)
/*     */       });
/*  42 */   private static final TranslationTextComponent LOGIA_INVULN_NAME = new TranslationTextComponent(WyRegistry.registerName("ability.mineminenomi.logia_invulnerability", "Logia Invulnerability"));
/*     */   
/*     */   private Supplier<ParticleEffect<?>> particleEffect;
/*     */   public ILogiaReturnEffect onLogiaEffect = (target, attacker) -> true;
/*     */   
/*     */   public LogiaInvulnerabilityAbility(AbilityCore<SourceImmunityAbility> core, @Nullable SourceImmunityAbility.SourceImmunityInfo immunityInfo, Supplier<ParticleEffect<?>> particleEffect) {
/*  48 */     super(core, immunityInfo);
/*  49 */     this.particleEffect = particleEffect;
/*  50 */     setDisplayName((ITextComponent)LOGIA_INVULN_NAME);
/*     */   }
/*     */ 
/*     */   
/*     */   public boolean isDamageTaken(LivingEntity entity, DamageSource source, float amount) {
/*  55 */     Entity directEntity = source.func_76364_f();
/*     */     
/*  57 */     if (directEntity != null && directEntity instanceof LivingEntity && FactionEvents.isDirectHit(source)) {
/*  58 */       LivingEntity attacker = (LivingEntity)directEntity;
/*     */       
/*  60 */       if (attacker.func_184586_b(attacker.func_184600_cs()).func_190926_b()) {
/*  61 */         BusoshokuHakiEmissionAbility emissionHaki = (BusoshokuHakiEmissionAbility)AbilityDataCapability.get(attacker).getEquippedAbility(BusoshokuHakiEmissionAbility.INSTANCE);
/*     */         
/*  63 */         boolean hasEmissionActive = (emissionHaki != null && emissionHaki.isContinuous());
/*     */         
/*  65 */         if (CommonConfig.INSTANCE.isLogiaDamageEffectEnabled() && !hasEmissionActive) {
/*  66 */           this.onLogiaEffect.returnEffect(entity, attacker);
/*     */         }
/*     */       } 
/*     */     } 
/*     */     
/*  71 */     if (!((Boolean)AbilitiesConfig.LOGIA_INVULNERABILITY.get()).booleanValue() || (source instanceof ModDamageSource && ((ModDamageSource)source).isBypassingLogia())) {
/*  72 */       return true;
/*     */     }
/*     */     
/*  75 */     if (DevilFruitCapability.get(entity).hasYamiPower()) {
/*  76 */       return true;
/*     */     }
/*     */     
/*  79 */     if (source instanceof AbilityDamageSource && ((AbilityDamageSource)source).getElement() == SourceElement.SHOCKWAVE) {
/*  80 */       return true;
/*     */     }
/*     */     
/*  83 */     if (directEntity != null) {
/*  84 */       LivingEntity sourceOwner = null;
/*     */       
/*  86 */       if (directEntity instanceof LivingEntity) {
/*  87 */         sourceOwner = (LivingEntity)directEntity;
/*  88 */       } else if (directEntity instanceof AbilityProjectileEntity) {
/*  89 */         sourceOwner = ((AbilityProjectileEntity)directEntity).getThrower();
/*  90 */       } else if (directEntity instanceof ProjectileEntity) {
/*  91 */         Entity projectileOwner = ((ProjectileEntity)directEntity).func_234616_v_();
/*     */         
/*  93 */         if (projectileOwner != null && projectileOwner instanceof LivingEntity) {
/*  94 */           sourceOwner = (LivingEntity)projectileOwner;
/*     */           
/*  96 */           boolean hasImbuingActive = HakiHelper.hasImbuingActive((LivingEntity)projectileOwner);
/*     */           
/*  98 */           if (hasImbuingActive) {
/*  99 */             return true;
/*     */           }
/* 101 */           spawnParticles(entity);
/*     */           
/* 103 */           return false;
/*     */         } 
/*     */       } 
/*     */ 
/*     */       
/* 108 */       if (sourceOwner != null) {
/* 109 */         boolean isBlocking = AbilityHelper.isLogiaBlocking((Entity)sourceOwner, entity);
/* 110 */         if (!isBlocking) {
/* 111 */           return true;
/*     */         }
/*     */ 
/*     */ 
/*     */         
/* 116 */         boolean hasImbuingActive = HakiHelper.hasImbuingActive(sourceOwner);
/* 117 */         boolean hasHardeningActive = HakiHelper.hasHardeningActive(sourceOwner);
/* 118 */         boolean bool1 = true;
/*     */         
/* 120 */         if (source instanceof ModDamageSource) {
/* 121 */           ModDamageSource mSource = (ModDamageSource)source;
/*     */           
/* 123 */           if (mSource.getHakiNature() == SourceHakiNature.IMBUING && hasImbuingActive) {
/* 124 */             bool1 = false;
/* 125 */           } else if (mSource.getHakiNature() == SourceHakiNature.HARDENING && hasHardeningActive) {
/* 126 */             bool1 = false;
/* 127 */           } else if (mSource.getHakiNature() == SourceHakiNature.SPECIAL && (hasImbuingActive || hasHardeningActive)) {
/* 128 */             bool1 = false;
/*     */           } 
/* 130 */         } else if (source instanceof net.minecraft.util.EntityDamageSource) {
/* 131 */           bool1 = !hasHardeningActive;
/* 132 */         } else if (source instanceof net.minecraft.util.IndirectEntityDamageSource) {
/* 133 */           bool1 = !hasImbuingActive;
/*     */         } 
/*     */         
/* 136 */         if (bool1) {
/* 137 */           spawnParticles(entity);
/*     */           
/* 139 */           return false;
/*     */         } 
/* 141 */         return true;
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 147 */     boolean hasShadow = EntityStatsCapability.get(entity).hasShadow();
/*     */     
/* 149 */     if (this.immunityInfo.isImmune(DamageSource.field_76370_b) && source.func_76347_k() && !hasShadow) {
/* 150 */       return true;
/*     */     }
/*     */     
/* 153 */     if (source.func_94541_c()) {
/* 154 */       spawnParticles(entity);
/*     */       
/* 156 */       return false;
/*     */     } 
/*     */     
/* 159 */     boolean isImmune = this.immunityInfo.isImmune(source);
/*     */ 
/*     */     
/* 162 */     boolean fireResistance = this.immunityInfo.isImmune(DamageSource.field_76370_b);
/*     */     
/* 164 */     if (source.field_76373_n.equalsIgnoreCase(DamageSource.field_76370_b.field_76373_n) && fireResistance && hasShadow) {
/* 165 */       entity.func_70066_B();
/*     */       
/* 167 */       spawnParticles(entity);
/*     */       
/* 169 */       return false;
/*     */     } 
/*     */     
/* 172 */     if (isImmune) {
/* 173 */       spawnParticles(entity);
/*     */       
/* 175 */       return false;
/*     */     } 
/*     */     
/* 178 */     return true;
/*     */   }
/*     */   
/*     */   public void spawnParticles(LivingEntity entity) {
/* 182 */     WyHelper.spawnParticleEffect(this.particleEffect.get(), (Entity)entity, entity.func_226277_ct_(), entity.func_226278_cu_(), entity.func_226281_cx_());
/*     */   }
/*     */   
/*     */   public static interface ILogiaReturnEffect extends Serializable {
/*     */     boolean returnEffect(LivingEntity param1LivingEntity1, LivingEntity param1LivingEntity2);
/*     */   }
/*     */ }


/* Location:              C:\Users\herrc\Downloads\mine-mine-no-mi-1.16.5-0.10.8.jar!\xyz\pixelatedw\mineminenomi\abilities\LogiaInvulnerabilityAbility.class
 * Java compiler version: 8 (52.0)
 * JD-Core Version:       1.1.3
 */